<!DOCTYPE html>

<html>

<head>
	<title>139 Todo</title>
	
	<script src="https://unpkg.com/vue"></script>
	<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
	
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/css/materialize.min.css">
	<link rel="stylesheet" type="text/css" href="css/main-style.css">

	<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/js/materialize.min.js"></script>

	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body class="grey lighten-5">
	<div id="app139">

		<nav class="grey lighten-4">
			<div class="nav-wrapper container">
				<a href="#" class="brand-logo center teal-text text-darken-4">139</a>
				<ul id="nav-mobile" class="right hide-on-med-and-down">
					<li v-if="!logged" v-bind:class="{ active: isPageActive('login') }"><router-link to="/login" class="teal-text text-darken-4">Sign In</router-link></li>
					<li v-if="logged" v-bind:class="{ active: isPageActive('tasks') }"><router-link to="/tasks" class="teal-text text-darken-4">Tasks</router-link></li>
					<li v-if="logged" v-bind:class="{ active: isPageActive('editTaskList') }"><router-link to="/editTaskList" class="teal-text text-darken-4">Edit Task List</router-link></li>
					<li v-if="logged" v-bind:class="{ active: isPageActive('settings') }"><a href="#" class="teal-text text-darken-4">Settings</a></li>
					<li v-if="logged"><a v-on:click="performUserLogout()" class="teal-text text-darken-4">Logout</a></li>
				</ul>
			</div>
		</nav>
		
		<main class="container">
			<router-view :user-name="userInfo.userName" :populate-user-info="populateUserInfo" :update-active-page="updateActivePage"></router-view>
		</main>
	</div>
</body>

<!-- Single task template -->
<template id="task-template">
	<div class="row">
		<div class="col s12">
			<p>
				<span v-on:click="checkTask(task, $event)" v-bind:class="{ taskCompleted: task.isCompleted }" :id="generateTagId(task.id)">{{ task.text }}</span>
			</p>
		</div>
	</div>
</template>

<!-- Task list header template -->
<template id="task-list-header-template">
	<div>
		<div class="row"></div>
		<div class="row center">
			<div class="col s12">
				<h4 class="top-title ">Welcome {{ userName }}! Here are your tasks for today:</h4>
			</div>
		</div>
	</div>
</template>

<!-- Task list template -->
<template id="task-list-template">
	<div>
		<h3 class="center">{{ listTitle }}</h3>
		<div class="divider teal darken-4"></div>
		<div class="row center" :id="'task-level-' + listTitle">
			<div class="col s12">
				<task v-for="task in taskList" 
					  v-bind:task="task" 
					  v-bind:key="task.id" 
					  :update-task-list-status="updateTaskListStatus" >
				</task>
			</div>
		</div>
	</div>
</template>

<!-- Task list container template -->
<template id="task-list-container-template">
	<div>
		<task-list-header :user-name="userName"></task-list-header>

		<div class="task-viewport valign-wrapper center-align">			
			<transition name="my-slide" mode="out-in">
				<task-list v-if="isListActive('1')" key="task-1" :task-list="taskLists.tasks1" :list-title="'1'" :active-list="activeList" :update-task-list-status="updateTaskListStatus"></task-list>
				<task-list v-if="isListActive('3')" key="task-3" :task-list="taskLists.tasks3" :list-title="'3'" :active-list="activeList" :update-task-list-status="updateTaskListStatus"></task-list>
				<task-list v-if="isListActive('9')" key="task-9" :task-list="taskLists.tasks9" :list-title="'9'" :active-list="activeList" :update-task-list-status="updateTaskListStatus"></task-list>
				<task-list v-if="isListActive('0')" key="task-0" :task-list="taskLists.tasks0" :list-title="'0'" :active-list="activeList" :update-task-list-status="updateTaskListStatus"></task-list>
			</transition>
		</div>
	</div>
</template>

<!-- Login template -->
<template id="login-page-template">
	<div>
		<div class="row"></div>
		<div class="row">
			<div class="col s12">
				<h4>Sign In to 139</h4>
			</div>
		</div>

		<div class="row">
			<form class="col s12">			
				<div class="row">
					<div class="input-field col s12">
						<input id="email" type="email" class="validate" v-model="email">
						<label for="email">Email</label>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s12">
						<input id="password" type="password" class="validate" v-model="password">
						<label for="password">Password</label>
					</div>
				</div>
			</form>
		</div>
		<a v-on:click="performUserLogin()" class="waves-effect waves-light btn teal darken-4">Sign In</a>
	</div>	
</template>

<template id="edit-task-list-template">
	<div>
		<div class="row"></div>
		<div class="row">
			<div class="col s12">
				<h4>Edit Task List</h4>
			</div>
		</div>

		<div class="row">
			<div class="input-field col s8">
				<input v-model="taskText" id="task_description" type="text">
				<label for="first_name">Task Description</label>
			</div>
			<div class="input-field col s3">
				<select v-select="taskPriority">
					<option value="" disabled selected>Select a priority</option>
					<option value="1">1</option>
					<option value="3">3</option>
					<option value="9">9</option>
					<option value="0">No priority</option>
				</select>
				<label>Priority</label>
			</div>
			<div class="input-field col s1">
				<a v-on:click="addTask()" class="btn-floating waves-effect waves-light green"><i class="material-icons">add</i></a>
			</div>
		</div>

		<div class="row"></div>
		<div class="row">
			<div class="col s12">
				<h4>Task List</h4>
			</div>
		</div>

		<!-- Implement edit button -->

		<h5>1</h5>
		<ul class="collection">
			<li v-for="task in taskLists.tasks1" class="collection-item">
				<div>
					{{ task.text }}
					<a href="#!" class="secondary-content"><i class="material-icons grey-text text-darken-2">edit</i></a>
				</div>
			</li>
		</ul>

		<h5>3</h5>
		<ul class="collection">
			<li v-for="task in taskLists.tasks3" class="collection-item">
				<div>
					{{ task.text }}
					<a href="#!" class="secondary-content"><i class="material-icons grey-text text-darken-2">edit</i></a>
				</div>
			</li>
		</ul>

		<h5>9</h5>
		<ul class="collection">
			<li v-for="task in taskLists.tasks9" class="collection-item">
				<div>
					{{ task.text }}
					<a href="#!" class="secondary-content"><i class="material-icons grey-text text-darken-2">edit</i></a>
				</div>
			</li>
		</ul>

		<h5>Other Tasks</h5>
		<ul class="collection">
			<li v-for="task in taskLists.tasks0" class="collection-item">
				<div>
					{{ task.text }}
					<a href="#!" class="secondary-content"><i class="material-icons grey-text text-darken-2">edit</i></a>
				</div>
			</li>
		</ul>

	</div>

</template>


<script type="text/javascript">
	Vue.component('task', {
		props: ['task', 'updateTaskListStatus'],
		template: '#task-template',
		methods: {
			checkTask: function (task, event) {
				task.isCompleted = !(task.isCompleted)
				document.getElementById("task-" + task.id).classList.add('taskCompleted')
				this.updateTaskListStatus(task)
			},
			generateTagId: function (id) {
				return "task-" + id
			},
		}
	})

	var TaskListComponent = Vue.component('task-list-container', {
		props: ['userName', 'updateActivePage'],
		template: '#task-list-container-template',
		data: function() {
			return {
				activeList: '1',
				taskLists: {
					tasks1: [
						{ id: 1, text: 'Build an MVP for 139', isCompleted: false, priority: '1' },
					],
					tasks3: [
						{ id: 2, text: 'Learn about with vue.js framework', isCompleted: false, priority: '3' },
						{ id: 3, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '3' },
						{ id: 4, text: 'Continue improving 139', isCompleted: false, priority: '3' },
					],
					tasks9: [
						{ id: 5, text: 'Build an initial design for 139', isCompleted: false, priority: '9' },
						{ id: 6, text: 'Continue improving 139', isCompleted: false, priority: '9' },
						{ id: 7, text: 'Learn about with vue.js framework', isCompleted: false, priority: '9' },
						{ id: 8, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '9' },
						{ id: 9, text: 'Build an MVP for 139', isCompleted: false, priority: '9' },
						{ id: 10, text: 'Continue improving 139', isCompleted: false, priority: '9' },
						{ id: 11, text: 'Learn about with vue.js framework', isCompleted: false, priority: '9' },
						{ id: 12, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '9' },
						{ id: 13, text: 'Build an MVP for 139', isCompleted: false, priority: '9' },
					],
					tasks0: [
						{ id: 14, text: 'Continue improving 139', isCompleted: false, priority: '0' },
						{ id: 15, text: 'Learn about with vue.js framework', isCompleted: false, priority: '0' },
						{ id: 16, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '0' },
						{ id: 17, text: 'Build an MVP for 139', isCompleted: false, priority: '0' },
					],
				},
			}
		},
		methods: {
			updateTaskListStatus: function (task) {		// Write a clever code to check this...
				priority = task.priority;
				if (priority == '1') {
					if (this.taskLists.tasks1[0].isCompleted) {
						this.activeList = '3'
					}
				}
				if (priority == '3') {
					threeCompleted = true
					for (var i = 0; i < this.taskLists.tasks3.length; i++) {
						if (this.taskLists.tasks3[i].isCompleted == false) {
							threeCompleted = false
						}
					}
					if (threeCompleted) {
						this.activeList = '9'
					}
				}
				if (priority == '9') {
					nineCompleted = true;
					for (var i = 0; i < this.taskLists.tasks9.length; i++) {
						if (this.taskLists.tasks9[i].isCompleted == false) {
							nineCompleted = false
						}
					}
					if (nineCompleted) {
						this.activeList = '0'
					}
				}
			},
			isListActive: function(listTitle) {
				if (listTitle == this.activeList) {
					return true
				}
				return false
			},
		},
		mounted: function () {
			this.updateActivePage("tasks")
		}
	})

	Vue.component('task-list-header', {
		props: ['userName'],
		template: '#task-list-header-template'
	})

	Vue.component('task-list', {
		props: ['taskList', 'listTitle', 'activeList', 'updateTaskListStatus'],
		template: '#task-list-template'
	})

	var LoginComponent = Vue.component('login-page', {
		props: ['populateUserInfo', 'updateActivePage'],
		template: '#login-page-template',
		data: function () {
			return {
				email: null,
				password: null
			}
		},
		methods: {
			performUserLogin: function () {
				// validate email.value and password.value, return to userInfo
				// perform login operations in the RESTful API
				var userInfo = {
					userID: "3a761bd9",
					userEmail: "lucas@lasobrinho.com",
					userName: "Lucas",
					// ...
				}
				if (true) {
					this.populateUserInfo(userInfo)
					router.push({ path: '/tasks' })
				}
			}
		},
		mounted: function () {
			this.updateActivePage("login")
		}
	})

	var EditTaskListComponent = Vue.component('edit-task-list', {
		props: ['updateActivePage'],
		template: '#edit-task-list-template',
		data: function () {
			return {
				taskText: '',
				taskPriority: '',
				taskLists: {
					tasks1: [],
					tasks3: [],
					tasks9: [],
					tasks0: []
				},
				taskListsMapping: {
					'1': 'tasks1',
					'3': 'tasks3',
					'9': 'tasks9',
					'0': 'tasks0'
				}
			}
		},
		methods: {
			addTask: function () {
				this.taskLists[this.taskListsMapping[this.taskPriority]].push({ id: Math.random(), text: this.taskText, isCompleted: false, priority: this.taskPriority })
			}
		},
		mounted: function () {
			this.updateActivePage("editTaskList")
		}
	})

	const routes = [
		{ path: '/tasks', component: TaskListComponent }, 
		{ path: '/login', component: LoginComponent }, 
		{ path: '/editTaskList', component: EditTaskListComponent }
	]
	const router = new VueRouter({
		routes: routes
	})

	Vue.directive("select", {
		"twoWay": true,

		update: function(el, binding, vnode) {
			if(!vnode.elm.dataset.vueSelectReady) {

				$(el).on('change', function() {
					vnode.context.$set(vnode.context, binding.expression, el.value)
				})

				$(el).material_select()
				vnode.elm.dataset.vueSelectReady = true
			}
		},

		unbind: function(el, binding, vnode) {
			$(el).material_select('destroy')
		}
	})

	var app = new Vue({
		el: '#app139',
		router,
		data: {
			logged: false,
			firstLogin: false,
			userInfo: {},
			activePage: ""
		},
		methods: {
			populateUserInfo: function (userInfo) {
				this.userInfo = userInfo
				this.logged = true
			},
			performUserLogout: function () {
				// perform logout operations in the RESTful API
				this.userInfo = {}
				this.logged = false
				this.activePage = ""
				router.push({ path: '/' })
			},
			updateActivePage: function (page) {
				this.activePage = page
			},
			isPageActive: function (page) {
				if (this.activePage == page) {
					return true
				}
				return false
			}
		}
	}).$mount('#app139')

</script>

<script type="text/javascript">
	$(document).ready(function() {
		$('select').material_select();
	});
</script>

</html>