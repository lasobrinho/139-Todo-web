<!DOCTYPE html>

<html>

<head>
	<title>139 Todo</title>
	
	<script src="https://unpkg.com/vue"></script>
	<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
	
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/css/materialize.min.css">
	<link rel="stylesheet" type="text/css" href="css/main-style.css">

	<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/js/materialize.min.js"></script>

	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body class="grey lighten-5">
	<div id="app139">

		<nav class="grey lighten-4">
			<div class="nav-wrapper container">
				<a href="#" class="brand-logo center teal-text text-darken-4">139</a>
				<ul id="nav-mobile" class="right hide-on-med-and-down">
					<li v-if="!logged" v-bind:class="{ active: isPageActive('login') }"><router-link to="/login" class="teal-text text-darken-4">Sign In</router-link></li>
					<li v-if="logged" v-bind:class="{ active: isPageActive('tasks') }"><router-link to="/tasks" class="teal-text text-darken-4">Tasks</router-link></li>
					<li v-if="logged" v-bind:class="{ active: isPageActive('createTaskList') }"><router-link to="/createTaskList" class="teal-text text-darken-4">Create Task List</router-link></li>
					<li v-if="logged" v-bind:class="{ active: isPageActive('createTaskListAll') }"><router-link to="/createTaskListAll" class="teal-text text-darken-4">Create Task List All</router-link></li>
					<li v-if="logged" v-bind:class="{ active: isPageActive('settings') }"><a href="#" class="teal-text text-darken-4">Settings</a></li>
					<li v-if="logged"><a v-on:click="performUserLogout()" class="teal-text text-darken-4">Logout</a></li>
				</ul>
			</div>
		</nav>
		
		<main class="container">
			<router-view :user-name="userInfo.userName" :populate-user-info="populateUserInfo" :update-active-page="updateActivePage"></router-view>
		</main>
	</div>
</body>

<!-- Single task template -->
<template id="task-template">
	<div class="row">
		<div class="col s12">
			<p>
				<span v-on:click="checkTask(task, $event)" v-bind:class="{ taskCompleted: task.isCompleted }" :id="generateTagId(task.id)">{{ task.text }}</span>
			</p>
		</div>
	</div>
</template>

<!-- Task list header template -->
<template id="task-list-header-template">
	<div>
		<div class="row"></div>
		<div class="row center">
			<div class="col s12">
				<h4 class="top-title ">Welcome {{ userName }}! Here are your tasks for today:</h4>
			</div>
		</div>
	</div>
</template>

<!-- Task list template -->
<template id="task-list-template">
	<div>
		<h3 class="center">{{ listTitle }}</h3>
		<div class="divider teal darken-4"></div>
		<div class="row center" :id="'task-level-' + listTitle">
			<div class="col s12">
				<task v-for="task in taskList" 
					  v-bind:task="task" 
					  v-bind:key="task.id" 
					  :update-task-list-status="updateTaskListStatus" >
				</task>
			</div>
		</div>
	</div>
</template>

<!-- Task list container template -->
<template id="task-list-container-template">
	<div>
		<task-list-header :user-name="userName"></task-list-header>

		<div class="task-viewport valign-wrapper center-align">			
			<transition name="my-slide" mode="out-in">
				<task-list v-if="isListActive('1')" key="task-1" :task-list="taskLists.tasks1" :list-title="'1'" :active-list="activeList" :update-task-list-status="updateTaskListStatus"></task-list>
				<task-list v-if="isListActive('3')" key="task-3" :task-list="taskLists.tasks3" :list-title="'3'" :active-list="activeList" :update-task-list-status="updateTaskListStatus"></task-list>
				<task-list v-if="isListActive('9')" key="task-9" :task-list="taskLists.tasks9" :list-title="'9'" :active-list="activeList" :update-task-list-status="updateTaskListStatus"></task-list>
				<task-list v-if="isListActive('0')" key="task-0" :task-list="taskLists.tasks0" :list-title="'0'" :active-list="activeList" :update-task-list-status="updateTaskListStatus"></task-list>
			</transition>
		</div>
	</div>
</template>

<!-- Login template -->
<template id="login-page-template">
	<div>
		<div class="row"></div>
		<div class="row">
			<div class="col s12">
				<h4>Sign In to 139</h4>
			</div>
		</div>

		<div class="row">
			<form class="col s12">			
				<div class="row">
					<div class="input-field col s12">
						<input id="email" type="email" class="validate" v-model="email">
						<label for="email">Email</label>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s12">
						<input id="password" type="password" class="validate" v-model="password">
						<label for="password">Password</label>
					</div>
				</div>
			</form>
		</div>
		<a v-on:click="performUserLogin()" class="waves-effect waves-light btn teal darken-4">Sign In</a>
	</div>	
</template>

<template id="task-collection-template">
	<div>
		<h5 class="center">{{ taskListTitle }}</h5>
		<ul class="collection">
			<li v-for="task in taskList" class="collection-item task-collection-li">
				<div>
					<div class="row task-collection-row task-collection-main">
						<div class="col s9">
							{{ task.text }}
						</div>
						<div class="col s3">
							<a v-on:click="deleteTask(task)" class="secondary-content">&nbsp Delete</a>
							<a v-on:click="editTask(task)" class="secondary-content">Edit &nbsp |</a>
						</div>
					</div>
					<div v-if="task.priority" class="row task-collection-row task-collection-secondary">
						<div class="col s12">
							<span class="grey-text text-darken-1">Added on {{ task.dateAdded }} &nbsp Â· &nbsp Previous priority: {{ task.priority }}</span>
						</div>
					</div>	
					<div v-else class="row task-collection-row task-collection-secondary">
						<div class="col s12">
							<span class="grey-text text-darken-1">New</span>
						</div>
					</div>			
				</div>
			</li>
		</ul>
	</div>
</template>

<template id="create-task-list-template">
	<div>
		<div class="row"></div>
		<div class="row">
			<div class="col s12">
				<h4>Today's Task List</h4>
			</div>
		</div>

		<div class="row">
			<div class="input-field col s9">
				<input v-model="task.text" id="task_description" type="text">
				<label for="first_name">Task Description</label>
			</div>
			<div class="input-field col s2">
				<span class="priority-select priority-1" v-bind:class="{ 'priority-disabled': isPriorityListFull('1'), 'priority-selected': task.priority=='1' }" v-on:click="setTaskPriority(task, '1')">1</span>
				<span class="priority-select priority-3" v-bind:class="{ 'priority-disabled': isPriorityListFull('3'), 'priority-selected': task.priority=='3' }" v-on:click="setTaskPriority(task, '3')">3</span>
				<span class="priority-select priority-9" v-bind:class="{ 'priority-disabled': isPriorityListFull('9'), 'priority-selected': task.priority=='9' }" v-on:click="setTaskPriority(task, '9')">9</span>
				<span class="priority-select priority-0" v-bind:class="{ 'priority-disabled': disableOtherTasks(), 'priority-selected': task.priority=='0' }" v-on:click="setTaskPriority(task, '0')">Other</span>
			</div>			
			<div class="input-field col s1">
				<a v-if="taskAction.add" v-on:click="addTask()" class="btn-floating waves-effect waves-light green" v-bind:class="{ disabled: validateTask() }"><i class="material-icons">add</i></a>
				<a v-if="taskAction.edit" v-on:click="finishEditTask()" class="btn-floating waves-effect waves-light orange" v-bind:class="{ disabled: validateTask() }"><i class="material-icons">edit</i></a>
			</div>
		</div>

		<task-collection task-list-title="1" :task-list="taskLists.tasks1" :edit-task="editTask" :delete-task="deleteTask"></task-collection>
		<task-collection task-list-title="3" :task-list="taskLists.tasks3" :edit-task="editTask" :delete-task="deleteTask"></task-collection>
		<task-collection task-list-title="9" :task-list="taskLists.tasks9" :edit-task="editTask" :delete-task="deleteTask"></task-collection>
		<task-collection task-list-title="Other Tasks" :task-list="taskLists.tasks0" :edit-task="editTask" :delete-task="deleteTask"></task-collection>

	</div>
</template>

<template id="create-task-list-all-template">
	<div>
		<div class="row"></div>
		<div class="row">
			<div class="col s12">
				<h4 class="center">Today's Task List</h4>
			</div>
		</div>
		<div class="row"></div>
		<div class="row">
			<div class="col s12">
				<h5>Add New Tasks</h5>
				<p>List all the new tasks you have to complete, regardless of their priorities</p>
			</div>
		</div>
		<div class="row">
			<div class="input-field col s11">
				<input v-model="task.text" id="task_description" type="text">
				<label for="first_name">Task Description</label>
			</div>			
			<div class="input-field col s1 center">
				<a v-if="taskAction.add" v-on:click="addTask()" class="btn-floating waves-effect waves-light green" v-bind:class="{ disabled: validateTask() }"><i class="material-icons">add</i></a>
				<a v-if="taskAction.edit" v-on:click="finishEditTask()" class="btn-floating waves-effect waves-light orange" v-bind:class="{ disabled: validateTask() }"><i class="material-icons">edit</i></a>
			</div>
		</div>

		<task-collection task-list-title="New Tasks" :task-list="tasks" :edit-task="editTask" :delete-task="deleteTask"></task-collection>


		<div class="row"></div>
		<div class="row"></div>
		<div class="row">
			<div class="col s12">
				<h5>Your Pending Tasks</h5>
				<p>Tasks that you added before but are still pending to be completed</p>
			</div>
		</div>

		<task-collection task-list-title="Pending Tasks" :task-list="pendingTasks" :edit-task="editTask" :delete-task="deleteTask"></task-collection>

	</div>
</template>


<script type="text/javascript">

	function getCurrentDate() {
		var date = new Date()
		return date.getMonth() + '/' + date.getDate() + '/' + date.getFullYear()
	}

	var CreateTaskList = Vue.component('create-task-list', {
		props: ['updateActivePage'],
		template: '#create-task-list-template',
		data: function () {
			return {
				task: {
					id: 0, 
					text: '', 
					isCompleted: false, 
					priority: ''
				},
				tasks: [],
				taskLists: {
					tasks1: [],
					tasks3: [],
					tasks9: [],
					tasks0: []
				},
				taskListsMapping: {
					'1': 'tasks1',
					'3': 'tasks3',
					'9': 'tasks9',
					'0': 'tasks0'
				},
				taskAction: {
					'add': true,
					'edit': false
				}
			}
		},
		methods: {
			setTaskAction: function (taskAction) {
				if (taskAction == 'add') {
					this.taskAction = { 'add': true, 'edit': false }
				}
				if (taskAction == 'edit') {
					this.taskAction = { 'add': false, 'edit': true }
				}
			},
			resetTask: function () {
				this.task = {
					id: 0, 
					text: '', 
					isCompleted: false, 
					priority: ''
				}
			},
			addTask: function () {
				this.task.id = Math.random()
				this.taskLists[this.taskListsMapping[this.task.priority]].push(this.task)
				this.resetTask()
			},
			addTaskToNewList: function (task) {
				this.taskLists[this.taskListsMapping[task.priority]].push(task)
			},
			editTask: function (task) {
				this.setTaskAction('edit')
				this.task = task
			},
			finishEditTask: function () {
				this.resetTask()
				this.setTaskAction('add')
			},
			deleteTask: function (task) {
				var taskList = this.taskLists[this.taskListsMapping[task.priority]]
				var index = taskList.indexOf(task);
				if (index > -1) {
					taskList.splice(index, 1);
				}
			},
			setTaskPriority: function (task, priority) {
				if (this.isPriorityListFull(priority)) {
					return
				}
				if (this.taskAction.edit) {
					if (task.priority != priority) {
						var tempTask = task
						this.deleteTask(task)
						tempTask.priority = priority
						this.addTaskToNewList(tempTask)
					}
				} else {
					task.priority = priority
				}
			},
			isPriorityNotSelected: function (priority) {
				if (this.task.priority == '') {
					return false
				}
				return !(this.task.priority == priority)
			},
			isPriorityListFull: function (priority) {
				if (this.taskLists[this.taskListsMapping[priority]].length == parseInt(priority)) {
					return true
				}
				return false
			},
			disableOtherTasks: function () {
				if (this.isPriorityListFull('1') && this.isPriorityListFull('3') && this.isPriorityListFull('9')) {
					return false
				}
				return true
			},
			validateTask: function () {
				if (this.task.text == '' || this.task.priority == '') {
					return true
				}
				return false
			}
		},
		mounted: function () {
			this.updateActivePage("createTaskList")
		}
	})

	var CreateTaskListAll = Vue.component('create-task-list-all', {
		props: ['updateActivePage'],
		template: '#create-task-list-all-template',
		data: function () {
			return {
				task: {
					id: 0, 
					text: '', 
					isCompleted: false, 
					priority: '',
					dateAdded: ''
				},
				tasks: [],
				pendingTasks: [
					{ id: 1, text: 'Build an MVP for 139', isCompleted: false, priority: '1', dateAdded: getCurrentDate() },
					{ id: 2, text: 'Learn about with vue.js framework', isCompleted: false, priority: '3', dateAdded: getCurrentDate() },
					{ id: 3, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '3', dateAdded: getCurrentDate() },
					{ id: 4, text: 'Continue improving 139', isCompleted: false, priority: '3', dateAdded: getCurrentDate() },
					{ id: 5, text: 'Build an initial design for 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					{ id: 6, text: 'Continue improving 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					{ id: 7, text: 'Learn about with vue.js framework', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					{ id: 8, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					{ id: 9, text: 'Build an MVP for 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					{ id: 10, text: 'Continue improving 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					{ id: 11, text: 'Learn about with vue.js framework', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					{ id: 12, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					{ id: 13, text: 'Build an MVP for 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					{ id: 14, text: 'Continue improving 139', isCompleted: false, priority: '0', dateAdded: getCurrentDate() },
					{ id: 15, text: 'Learn about with vue.js framework', isCompleted: false, priority: '0', dateAdded: getCurrentDate() },
					{ id: 16, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '0', dateAdded: getCurrentDate() },
					{ id: 17, text: 'Build an MVP for 139', isCompleted: false, priority: '0', dateAdded: getCurrentDate() },
				],
				taskAction: {
					'add': true,
					'edit': false
				}
			}
		},
		methods: {
			setTaskAction: function (taskAction) {
				if (taskAction == 'add') {
					this.taskAction = { 'add': true, 'edit': false }
				}
				if (taskAction == 'edit') {
					this.taskAction = { 'add': false, 'edit': true }
				}
			},
			resetTask: function () {
				this.task = {
					id: 0, 
					text: '', 
					isCompleted: false, 
					priority: '',
					dateAdded: ''
				}
			},
			addTask: function () {
				this.task.id = Math.random()
				this.tasks.push(this.task)
				this.resetTask()
			},
			addTaskToNewList: function (task) {
				this.tasks.push(task)
			},
			editTask: function (task) {
				this.setTaskAction('edit')
				this.task = task
			},
			finishEditTask: function () {
				this.resetTask()
				this.setTaskAction('add')
			},
			deleteTask: function (task) {
				if (task.priority) {
					var taskList = this.pendingTasks
				} else {
					var taskList = this.tasks
				}
				var index = taskList.indexOf(task);
				if (index > -1) {
					taskList.splice(index, 1);
				}				
			},
			validateTask: function () {
				if (this.task.text == '') {
					return true
				}
				return false
			}
		},
		mounted: function () {
			this.updateActivePage("createTaskListAll")
		}
	})
	
	Vue.component('task-collection', {
		props: ['taskListTitle', 'taskList', 'editTask', 'deleteTask'],
		template: '#task-collection-template'
	})
	

	Vue.component('task', {
		props: ['task', 'updateTaskListStatus'],
		template: '#task-template',
		methods: {
			checkTask: function (task, event) {
				task.isCompleted = !(task.isCompleted)
				document.getElementById("task-" + task.id).classList.add('taskCompleted')
				this.updateTaskListStatus(task)
			},
			generateTagId: function (id) {
				return "task-" + id
			},
		}
	})

	var TaskListComponent = Vue.component('task-list-container', {
		props: ['userName', 'updateActivePage'],
		template: '#task-list-container-template',
		data: function() {
			return {
				activeList: '1',
				taskLists: {
					tasks1: [
						{ id: 1, text: 'Build an MVP for 139', isCompleted: false, priority: '1', dateAdded: getCurrentDate() },
					],
					tasks3: [
						{ id: 2, text: 'Learn about with vue.js framework', isCompleted: false, priority: '3', dateAdded: getCurrentDate() },
						{ id: 3, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '3', dateAdded: getCurrentDate() },
						{ id: 4, text: 'Continue improving 139', isCompleted: false, priority: '3', dateAdded: getCurrentDate() },
					],
					tasks9: [
						{ id: 5, text: 'Build an initial design for 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
						{ id: 6, text: 'Continue improving 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
						{ id: 7, text: 'Learn about with vue.js framework', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
						{ id: 8, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
						{ id: 9, text: 'Build an MVP for 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
						{ id: 10, text: 'Continue improving 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
						{ id: 11, text: 'Learn about with vue.js framework', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
						{ id: 12, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
						{ id: 13, text: 'Build an MVP for 139', isCompleted: false, priority: '9', dateAdded: getCurrentDate() },
					],
					tasks0: [
						{ id: 14, text: 'Continue improving 139', isCompleted: false, priority: '0', dateAdded: getCurrentDate() },
						{ id: 15, text: 'Learn about with vue.js framework', isCompleted: false, priority: '0', dateAdded: getCurrentDate() },
						{ id: 16, text: 'Learn about with Materialize CSS framework', isCompleted: false, priority: '0', dateAdded: getCurrentDate() },
						{ id: 17, text: 'Build an MVP for 139', isCompleted: false, priority: '0', dateAdded: getCurrentDate() },
					],
				},
			}
		},
		methods: {
			updateTaskListStatus: function (task) {		// Write a clever code to check this...
				priority = task.priority;
				if (priority == '1') {
					if (this.taskLists.tasks1[0].isCompleted) {
						this.activeList = '3'
					}
				}
				if (priority == '3') {
					threeCompleted = true
					for (var i = 0; i < this.taskLists.tasks3.length; i++) {
						if (this.taskLists.tasks3[i].isCompleted == false) {
							threeCompleted = false
						}
					}
					if (threeCompleted) {
						this.activeList = '9'
					}
				}
				if (priority == '9') {
					nineCompleted = true;
					for (var i = 0; i < this.taskLists.tasks9.length; i++) {
						if (this.taskLists.tasks9[i].isCompleted == false) {
							nineCompleted = false
						}
					}
					if (nineCompleted) {
						this.activeList = '0'
					}
				}
			},
			isListActive: function(listTitle) {
				if (listTitle == this.activeList) {
					return true
				}
				return false
			},
		},
		mounted: function () {
			this.updateActivePage("tasks")
		}
	})

	Vue.component('task-list-header', {
		props: ['userName'],
		template: '#task-list-header-template'
	})

	Vue.component('task-list', {
		props: ['taskList', 'listTitle', 'activeList', 'updateTaskListStatus'],
		template: '#task-list-template'
	})

	var LoginComponent = Vue.component('login-page', {
		props: ['populateUserInfo', 'updateActivePage'],
		template: '#login-page-template',
		data: function () {
			return {
				email: null,
				password: null
			}
		},
		methods: {
			performUserLogin: function () {
				// validate email.value and password.value, return to userInfo
				// perform login operations in the RESTful API
				var userInfo = {
					userID: "3a761bd9",
					userEmail: "lucas@lasobrinho.com",
					userName: "Lucas",
					// ...
				}
				if (true) {
					this.populateUserInfo(userInfo)
					router.push({ path: '/createTaskListAll' })
				}
			}
		},
		mounted: function () {
			this.updateActivePage("login")
		}
	})

	const routes = [
		{ path: '/tasks', component: TaskListComponent }, 
		{ path: '/login', component: LoginComponent }, 
		{ path: '/createTaskList', component: CreateTaskList },
		{ path: '/createTaskListAll', component: CreateTaskListAll },
	]

	const router = new VueRouter({
		routes: routes
	})

	var app = new Vue({
		el: '#app139',
		router,
		data: {
			logged: false,
			firstLogin: false,
			userInfo: {},
			activePage: ""
		},
		methods: {
			populateUserInfo: function (userInfo) {
				this.userInfo = userInfo
				this.logged = true
			},
			performUserLogout: function () {
				// perform logout operations in the RESTful API
				this.userInfo = {}
				this.logged = false
				this.activePage = ""
				router.push({ path: '/' })
			},
			updateActivePage: function (page) {
				this.activePage = page
			},
			isPageActive: function (page) {
				if (this.activePage == page) {
					return true
				}
				return false
			}
		}
	}).$mount('#app139')

</script>

</html>